sudo: required

language: ruby

cache: bundler

rvm:
  - 2.3.0

services:
  - docker

before_script:
  - ./bin/rake db:create RAILS_ENV=test
  - ./bin/rake ridgepole:apply RAILS_ENV=test

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    ./bin/rake docker:build && ./bin/rake docker:push ;
    fi
